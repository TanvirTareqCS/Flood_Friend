{% extends 'base.html' %}
{% block title %}Resources{% endblock %}
{% block content %}
<div class="container">
  <h1>Emergency Resources</h1>
  {% if current_user.is_authenticated and current_user.role == 'admin' %}
    <div class="form-section">
      <h3>Add New Resource</h3>
      <form id="resourceForm" class="resource-form">
        <div class="form-group">
          <input type="text" id="resourceName" placeholder="Resource Name" required>
        </div>
        <div class="form-group">
          <select id="resourceType" required>
            <option value="">Select Type</option>
            <option value="shelter">Shelter</option>
            <option value="food">Food</option>
            <option value="medicine">Medicine</option>
            <option value="water">Water</option>
            <option value="clothing">Clothing</option>
            <option value="rescue">Rescue Team</option>
          </select>
        </div>
        <div class="form-group">
          <input type="text" id="resourceLocation" placeholder="Location" required>
        </div>
        <div class="form-group">
          <textarea id="resourceDescription" placeholder="Description"></textarea>
        </div>
        <div class="form-group">
          <input type="number" step="any" id="resourceLat" placeholder="Latitude" required>
        </div>
        <div class="form-group">
          <input type="number" step="any" id="resourceLng" placeholder="Longitude" required>
        </div>
        <div class="form-group">
          <input type="number" id="resourceCapacity" placeholder="Capacity">
        </div>
        <div class="form-group">
          <input type="text" id="resourceContact" placeholder="Contact Information">
        </div>
        <button type="submit" class="btn btn-primary btn-full">Add Resource</button>
      </form>
      <script>
        document.getElementById('resourceForm').addEventListener('submit', function(e) {
          e.preventDefault();
          fetch('/resources/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              name: document.getElementById('resourceName').value,
              type: document.getElementById('resourceType').value,
              location: document.getElementById('resourceLocation').value,
              description: document.getElementById('resourceDescription').value,
              latitude: document.getElementById('resourceLat').value,
              longitude: document.getElementById('resourceLng').value,
              capacity: document.getElementById('resourceCapacity').value,
              contact: document.getElementById('resourceContact').value
            })
          }).then(response => response.json()).then(data => {
            alert(data.message);
            location.reload();
          });
        });
      </script>
    </div>
  {% endif %}
  <div class="resources-list">
    {% for resource in resources %}
    <div class="resource-card">
      <h3>{{ resource.name }}</h3>
      <p><strong>Type</strong>: {{ resource.type }}</p>
      <p><strong>Location</strong>: {{ resource.location }}</p>
      {% if resource.description %}
        <p><strong>Description</strong>: {{ resource.description }}</p>
      {% endif %}
      <p><strong>Latitude</strong>: {{ resource.latitude }}</p>
      <p><strong>Longitude</strong>: {{ resource.longitude }}</p>
      {% if resource.capacity %}
        <p><strong>Capacity</strong>: {{ resource.capacity }} people</p>
      {% endif %}
      {% if resource.contact %}
        <p><strong>Contact</strong>: {{ resource.contact }}</p>
      {% endif %}
      {% if current_user.is_authenticated and current_user.role == 'admin' %}
        <form class="delete-resource-form" onsubmit="event.preventDefault(); deleteResource({{ resource.id }})">
          <button type="submit" class="btn btn-danger">Delete</button>
        </form>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  <script>
    function deleteResource(resourceId) {
      fetch(`/resources/delete/${resourceId}`, {
        method: 'POST',
      }).then(response => response.json()).then(data => {
        alert(data.message);
        location.reload();
      });
    }
  </script>
  <style>
    .form-section, .resources-list { margin-bottom: 2rem; }
    .resource-card { background: #fff; border-radius: 10px; box-shadow: 0 5px 24px rgba(0,0,0,0.06); padding: 1.2rem; margin-bottom: 1.5rem; }
    .resource-card h3 { margin-bottom: .6rem; color: #0d6efd; }
    .btn-full { width: 100%; padding: .7rem 0; border-radius: 6px; font-weight: bold; background: #0d6efd; color: white; border: none; cursor: pointer; font-size: 1.07rem;}
    .btn-danger { background: #dc3545; color: white; border: none; border-radius: 6px; font-size: 1rem; font-weight: bold; padding: .5rem 1rem; margin-top: .5rem; cursor: pointer; }
    .form-group label { display: block; margin-bottom: .3rem; font-weight: 600; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: .44rem .7rem; border-radius: 6px; border: 1px solid #ccc; font-size: 1rem; margin-bottom: .8rem; }
  </style>
</div>
{% endblock %}
