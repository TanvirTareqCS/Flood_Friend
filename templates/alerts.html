{% extends "base.html" %}
{% block title %}Alerts{% endblock %}
{% block content %}
<div class="container">
  <h1>Flood Alerts</h1>
  {% if current_user.is_authenticated and current_user.role == 'admin' %}
    <div class="form-section">
      <h3>Add New Alert</h3>
      <form id="alertForm" class="alert-form">
        <div class="form-group"><input type="text" id="alertTitle" placeholder="Alert Title" required></div>
        <div class="form-group"><input type="text" id="alertLocation" placeholder="Location" required></div>
        <div class="form-group">
          <select id="alertSeverity" required>
            <option value="">Select Severity</option>
            <option value="Low">Low</option>
            <option value="Medium">Medium</option>
            <option value="High">High</option>
            <option value="Critical">Critical</option>
          </select>
        </div>
        <div class="form-group"><textarea id="alertDescription" placeholder="Description" required></textarea></div>
        <div class="form-group"><input type="number" step="any" id="alertLat" placeholder="Latitude" required></div>
        <div class="form-group"><input type="number" step="any" id="alertLng" placeholder="Longitude" required></div>
        <button type="submit" class="btn btn-primary btn-full">Add Alert</button>
      </form>
      <script>
        document.getElementById('alertForm').addEventListener('submit', function(e) {
          e.preventDefault();
          fetch('/alerts/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              title: document.getElementById('alertTitle').value,
              location: document.getElementById('alertLocation').value,
              severity: document.getElementById('alertSeverity').value,
              description: document.getElementById('alertDescription').value,
              latitude: document.getElementById('alertLat').value,
              longitude: document.getElementById('alertLng').value
            })
          }).then(response => response.json()).then(data => {
            alert(data.message);
            location.reload();
          });
        });
      </script>
    </div>
  {% endif %}
  <div class="alerts-list">
    {% for alert in alerts %}
    <div class="alert-card">
      <h3>{{ alert.title }}</h3>
      <p><strong>Severity:</strong> {{ alert.severity }}</p>
      <p><strong>Location:</strong> {{ alert.location }}</p>
      <p><strong>Description:</strong> {{ alert.description }}</p>
      <p><strong>Time:</strong> {{ alert.timestamp.strftime('%Y-%m-%d %H:%M') }}</p>
      <p><strong>Coordinates:</strong> {{ alert.latitude }}, {{ alert.longitude }}</p>
      {% if current_user.is_authenticated and current_user.role == 'admin' %}
        <button onclick="deleteAlert({{ alert.id }})" class="btn btn-danger">Delete</button>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  <script>
    function deleteAlert(alertId) {
      fetch(`/alerts/delete/${alertId}`, {
        method: 'POST'
      }).then(response => response.json()).then(data => {
        alert(data.message);
        location.reload();
      });
    }
  </script>
  <style>
    .form-section, .alerts-list { margin-bottom: 2rem; }
    .alert-card { background: #fff; border-radius: 10px; box-shadow: 0 5px 24px rgba(0,0,0,0.06); padding: 1.2rem; margin-bottom: 1.5rem; }
    .alert-card h3 { margin-bottom: .5rem; color: #bd2130; }
    .btn-full { width: 100%; padding: .7rem 0; border-radius: 6px; font-weight: bold; background: #0d6efd; color: white; border: none; cursor: pointer; font-size: 1.07rem;}
    .btn-danger { background: #dc3545; color: white; border: none; border-radius: 6px; font-size: 1rem; font-weight: bold; padding: .5rem 1rem; margin-top: .5rem; cursor: pointer; }
    .form-group label { display: block; margin-bottom: .3rem; font-weight: 600; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: .44rem .7rem; border-radius: 6px; border: 1px solid #ccc; font-size: 1rem; margin-bottom: .8rem; }
  </style>
</div>
{% endblock %}
